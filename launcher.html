<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>SmartDashboard.js</title>
    <style>
        body, html, progress {
            width: 100%;
            text-align: center;
            padding: 0;
            margin: 0;
            -webkit-app-region: drag;
        }
        
        h1 {
            margin: 0;
        }
    </style>
    <script src="FileUtils.js"></script>
    <script>
        const fs = require('fs');
        const gui = require("nw.gui");
        
        var frame = true;
        
        var data = {
            sdver: gui.App.manifest.version,
            widgets: [],
            options: {}
        };
        
        try {
            var dataStr = fs.readFileSync(FileUtils.getDataLocations().save);
            data = JSON.parse(dataStr);
            if(data.options.dsMode){
                frame = false;
            }
        } catch (e) {
            console.log(e);
        }
        
        if(data.options.theme){
            document.write('<link rel="stylesheet" id="theme-css" href="themes/' + data.options.theme + '.css"/>');
        }
    </script>
</head>

<body class="launcher">
    <h1>SmartDashboard.js</h1>
    <script>
        gui.Window.get().show();
        
        if(typeof data.options.useDsModeSwitch == "undefined"){
            data.options.useDsModeSwitch = true;
        }
        
        global.data = data;
        
        if(gui.App.argv.indexOf("--ds-mode") > -1 && data.options.useDsModeSwitch){
            frame = false;
            data.options.dsMode = true;
        }
        
        global.initCallback = function(){
            gui.Window.get().close();
        };
        
        console.info("Launching");
        setTimeout(function(){
            gui.Window.open("index.html", {
                "title": "SmartDashboard",
                "icon": "assets/favicon.png",
                "frame": frame,
                "transparent": false,
                "show": false,
                "id": "SmartDashboard_main"
            }, function(win){
                setTimeout(function(){
                    win.show();
                    gui.Window.get().close();
                }, 5000);
            });
        }, 500); // give some time for splash to show up before the thread freezes
    </script>
</body>
</html>