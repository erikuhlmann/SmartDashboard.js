<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>SmartDashboard.js - Options</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" id="theme-css" />
    <style>
        body {
            padding-bottom: 5em;
        }
    </style>
</head>

<body class="options">
    <form action="javascript:void(0)" onsubmit="save()">
        <fieldset>
            <legend>Connection</legend>
            <label>Remote IP: <input type="text" id="ip" class="setting restart-required" /></label><br/>
            <label>Remote Port: <input type="number" id="port" class="setting restart-required" /></label>
        </fieldset>
        
        <fieldset>
            <legend>Default Widgets</legend>
            <label>Array: <select id="default-array" class="widget-select setting" data-filter="array"></select></label><br/>
            <label>Boolean: <select id="default-boolean" class="widget-select setting" data-filter="boolean"></select></label><br/>
            <label>Number: <select id="default-number" class="widget-select setting" data-filter="number"></select></label><br/>
            <label>Raw: <select id="default-raw" class="widget-select setting" data-filter="raw"></select></label><br/>
            <label>String: <select id="default-string" class="widget-select setting" data-filter="string"></select></label>
        </fieldset>
        
        <fieldset>
            <legend>Theme</legend>
            <div class="themes-view">
                <select id="theme" class="setting"></select>
            </div>
        </fieldset>
        
        <fieldset>
            <legend>Plugins</legend>
            <div class="plugins-view">
                No plugins
            </div>
        </fieldset>
        
        <div class="align-bottom text-right button-pane">
            <button type="submit">Save</button>
            <button type="button" onclick="cancel()">Cancel</button>
        </div>
    </form>
    <script>
        var restartRequired = false;
        global.SmartDashboard.setTheme(global.SmartDashboard.options.theme, document.querySelector("#theme-css"));
        [].forEach.call(document.querySelectorAll(".widget-select"), function(el){
            global.SmartDashboard.populateWidgetSelect(el);
        });
        
        global.SmartDashboard.populatePluginList(document.querySelector(".plugins-view"));
        global.SmartDashboard.populateThemeSelect(document.querySelector("#theme"));
        document.querySelector("#theme").onchange = function(e){
            global.SmartDashboard.setTheme(e.target.value);
            global.SmartDashboard.setTheme(e.target.value, document.querySelector("#theme-css"));
        };
        
        [].forEach.call(document.querySelectorAll(".setting"), function(el){
            el.value = global.SmartDashboard.options[el.id];
            if(el.classList.contains("restart-required")){
                el.addEventListener("change", function(){
                    restartRequired = true;
                });
            }
        });
        
        function cancel(){
            global.SmartDashboard.setTheme(global.SmartDashboard.options.theme);
            window.close();
        }
        function save(){
            [].forEach.call(document.querySelectorAll(".setting"), function(el){
                global.SmartDashboard.options[el.id] = el.value;
            });
            global.SmartDashboard.setTheme(global.SmartDashboard.options.theme);
            global.SmartDashboard.setTheme(global.SmartDashboard.options.theme, document.querySelector("#theme-css"));
            global.SmartDashboard.saveData();
            if(restartRequired && confirm("Restart required for changes to take effect. Restart Now?")){
                global.SmartDashboard.restart();
            } else {
                window.close();
            }
        }
    </script>
</body>
</html>